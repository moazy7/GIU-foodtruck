<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Menu</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="container">
    <header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <div><a class="btn" href="index.html">← Back</a></div>
      <nav>
        <a class="btn" href="index.html">Trucks</a>
        <a class="btn" href="cart.html">Cart</a>
        <a class="btn" href="orders.html">My Orders</a>
      </nav>
    </header>

    <h1 id="title">Menu</h1>

    <div class="card" style="padding:12px;margin-bottom:12px">
      <input id="filterInput" placeholder="Filter by category (e.g. Burgers)" style="padding:8px;width:60%"> <button id="filterBtn" class="btn">Filter</button> <button id="clearBtn" class="btn secondary">Clear</button>
    </div>

    <div id="items" class="list"></div>
  </div>
  <script type="module">
    import { getMenuByTruck, addToCart } from './js/api.js';
    const params = new URLSearchParams(location.search);
    const truckId = params.get('truckId');
    const title = document.getElementById('title');
    const itemsDiv = document.getElementById('items');
    async function init(){
      if(!truckId){ itemsDiv.innerText='No truck selected'; return; }
      title.innerText = 'Menu — Truck ' + truckId;
      const r = await getMenuByTruck(truckId);
      if(!r.ok){ itemsDiv.innerText = 'Could not load menu'; return; }
      const items = r.body || [];
      itemsDiv.innerHTML = items.map(it=>`
        <div class="card">
          <h3>${it.name}</h3>
          <p>${it.description||''}</p>
          <p>Price: ${it.price}</p>
          <p><button class="btn" data-id="${it.itemId}">Add to cart</button></p>
        </div>
      `).join('');
      itemsDiv.querySelectorAll('button[data-id]').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          const id = btn.dataset.id;
          const r2 = await addToCart(Number(id), 1);
          if(r2.ok) alert('Added to cart'); else alert('Add failed: '+(r2.body||r2.status));
        });
      });
      // wire filter
      document.getElementById('filterBtn').addEventListener('click', async ()=>{
        const cat = document.getElementById('filterInput').value.trim();
        if(!cat) return; const r = await getMenuByTruckCategory(truckId, cat); if(!r.ok){ alert('Filter failed'); return; }
        const items2 = r.body || [];
        itemsDiv.innerHTML = items2.map(it=>`<div class="card"><h3>${it.name}</h3><p>${it.description||''}</p><p>Price: ${it.price}</p><p><button class="btn" data-id="${it.itemId}">Add to cart</button></p></div>`).join('');
      });
      document.getElementById('clearBtn').addEventListener('click', ()=>{ document.getElementById('filterInput').value=''; init(); });
    }
    init();
  </script>
</body>
</html>
